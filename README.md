# Focus Scenes (Python Desktop App)

Оффлайн-приложение для фокус-сессий с геймификацией в стиле Forest и тремя сценами прогресса.

## Текущая структура проекта

- `app/main.py` — вход в приложение
- `app/ui/` — UI слой (главное окно)
- `app/core/` — бизнес-логика (`timer.py`, `app_state.py`, `assets.py`)
- `app/scenes/` — сцены и рендер
- `app/data/storage.py` — SQLite слой + инициализация схемы
- `tests/` — unit-тесты

## Pomodoro-возможности

- Строгие состояния таймера: `IDLE`, `FOCUS_RUNNING`, `FOCUS_PAUSED`, `BREAK_RUNNING`, `BREAK_PAUSED`, `FINISHED`, `FAILED`.
- Команды `Start/Pause/Resume/Stop` с точным временем на `time.monotonic()`.
- Пресеты:
  - `Pomodoro 25/5`
  - `Deep 50/10`
  - `TEST 1:00/0:30`
  - `Custom` (через spinbox `Focus/Break`)
- Быстрая правка фокуса: `+5 min` / `-5 min` (минимум 1 минута).
- Настройка **Авто-цикл**: после фокуса автоматически запускается break и следующий focus.
- Сохранение настроек таймера в SQLite settings:
  - выбранный preset
  - focus/break минуты
  - auto_cycle
- История последних сессий (до 50 записей): дата/время, длительность `MM:SS`, успех/провал, тема.

### Горячие клавиши

- `Space` — pause/resume (только если сессия уже активна)
- `Ctrl+Enter` — start из idle/finished/failed

### Логирование сессий

Запись идет в таблицу `sessions(id, started_at, duration_sec, theme, success, coins_earned)`:

- Успешный focus: `success=1`, `duration_sec` фактический (для полной сессии равен длительности фокуса).
- Stop во время focus: `success=0`, `duration_sec` фактически прошедшее время, `coins_earned=0`.
- Stop во время break: не создает fail фокус-сессии.


## Мини-план задач (правая панель)

- В главном окне добавлена правая фиксированная панель **«Задачи»** (до 5 задач).
- Ввод новой задачи: поле `Добавить задачу…` + кнопка `+` или `Enter`.
- После добавления поле очищается и фокус остается в поле.
- Счетчик в заголовке панели показывает выполненные/всего (`done/total`), например `Задачи (2/5)`.
- Когда задач 5/5 — добавление блокируется, кнопка `+` отключается и показывается подсказка **«Максимум 5 задач»**.
- Для каждой задачи доступны: чекбокс выполнения, удаление `×`, перемещение `↑/↓`.
- Все изменения сразу сохраняются в SQLite (таблица `tasks`), включая порядок (`sort_order`) и статус выполнения.
- При успешном завершении focus-сессии сохраняется snapshot задач в таблицу `session_tasks` (до 5 записей на сессию).

## Запуск

```bash
python -m venv .venv
source .venv/bin/activate   # Windows: .venv\Scripts\activate
pip install -r requirements.txt
python -m app.main
```

## Тесты

```bash
pytest -q
```


## Анимация самолёта (Flight scene)

Для sprite-анимации положите 4 PNG в `assets/plane/` с точными именами:

- `plane_fly_01.png`
- `plane_fly_02.png`
- `plane_fly_03.png`
- `plane_fly_04.png`

Проверка: запустите приложение, выберите сцену **Flight** и нажмите **Start** — во время состояния `running` самолёт листает кадры (в `paused` кадр заморожен, в `idle/finished/failed` сбрасывается на первый). Если ассеты не найдены, автоматически используется старая векторная отрисовка самолёта.
